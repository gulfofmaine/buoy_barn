# version: "3.7"

# services:
db:
  image: mdillon/postgis:10-alpine
  restart: always
  env_file:
    - ./docker-data/secret.env
  environment:
    PGDATA: /var/lib/postgresql/data/PGDATA
  volumes:
    - ./docker-data/postgres:/var/lib/postgresql/data

cache:
  image: redis:5.0.3-alpine
  restart: always

web:
  build: ./app
  command: bash -c "./utils/wait-for-it.sh db:5432 &&  python manage.py runserver 0:8080"
  restart: always
  volumes:
    - ./app:/app
    - ./.prospector.yaml:/app/.prospector.yaml
  ports:
    - "8080:8080"
  env_file:
    - ./docker-data/secret.env
  links:
    - db
    - cache
